<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Magic form with bootstrap 5</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!--
     Lesson objectives
	• Once a user has entered data into a field and has left the field the local storage will be updated.
	• After reloading the page, we retrieve data from the local storage and restore all input fields.

    My additional objectives
	• Add button for reset of local store.

	What we could do better:
	• use same id less often
     -->
</head>
<body>
<nav class="container p-3 bg-dark text-white text-left my-2">
    <a id="form-link">Form</a>
    <a id="history-link">History</a>
</nav>
<form class="container">
    <label class="fw-bold" for="first-name">First name</label><br>
    <input name="first-name" id="first-name" type="text" onchange="saveChange('first-name')"/><br><br>
    <label class="fw-bold" for="last-name" >Last name</label><br>
    <input name="last-name" id="last-name" type="text" onchange="saveChange('last-name')"/><br><br>
    <label class="fw-bold" for="email">Email</label><br>
    <input name="email" id="email" type="email" onchange="saveChange('email')"/><br><br>
    <label class="fw-bold" for="phone">Phone</label><br>
    <input name="phone" id="phone" type="tel" onchange="saveChange('phone')"/><br><br>
    <label class="fw-bold" for="company">Company</label><br>
    <input name="company" id="company" type="text"  onchange="saveChange('company')"/><br><br>
    <label class="fw-bold" for="address">Address</label><br>
    <input class="container-sm" name="address" id="address" type="text" onchange="saveChange('address')"/><br><br>
    <button class="" name="reset-button" id="reset-button" type="button" onclick="resetForm()">Reset form</button>
    <button class="" name="submit-button" id="submit-button" type="submit">Submit form</button>
</form>

<script>
    window.onload = reloadFormData;

    /** Restore element value from local data store. If no stored value is found,
     * element value won't be changed.
     * elementId: ID of the element which value to restore. */
    function restoreField(elementId) {
        // const elementId = "first-name";
        const storedValue = localStorage.getItem(elementId);
        if (storedValue != null) {
            document.getElementById(elementId).value = storedValue;
        } else {
            //document.getElementById(elementId).value = "empty";
        }
    }

    /** fill input fields with value from local save if available*/
    function reloadFormData() {
        restoreField("first-name");
        restoreField("last-name");
        restoreField("email");
        restoreField("phone");
        restoreField("company")
        restoreField("address");
    }

    function saveChange(changedElementId) {
        console.trace("saveChange() changedElementId: " + changedElementId)
        console.trace("The input value of element " + changedElementId + "has changed.");
        const elementValue = document.getElementById(changedElementId).value;
        console.trace("read element value: " + elementValue);
        localStorage.setItem(changedElementId, elementValue);
        console.trace("Local storage contains entry with key " + changedElementId +
            " and value " + localStorage.getItem(changedElementId));
    }

    /** Reset the form (visible part and stored data). */
    function resetForm() {
        localStorage.clear();
        reloadFormData();
        console.trace("local storage was cleared.")
    }
</script>

</body>
</html>
