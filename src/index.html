<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Magic form with bootstrap 5</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!--

     Project description
Purpose
	• This is a training project for the use of HTML und JavaScript.
	• Additionally I use Bootstrap 5.
	• The initial tasks were developed by Hyperskill.
	• Sadly the description and demands by Hyperskill are with gaps in inconsonsistent this time.
	• see https://hyperskill.org/projects/239/stages/1200/implement#comment

Description of main page
	• name: index.html
	• The user can enter data of a person.
	• The correctness and Vollständigkeit of person data will not be checked.
	• The user can save a person data set using the "Submit form" button. This way different person data sets can be created.

Draft data of person
	• Once a user has entered data into a field this change will be saved temporarily to local storage.
		○ We don't wait until the input field lost focus.
		○ This is draft data.
	• After reloading the page, we retrieve the draft data from the local storage and restore all input fields.
		○ If there is no draft data, we leave the fields empty.

Saved person data
Functional description
	• If the user clicks on the Submit Button the data will be saved permanently.
	• After the saving the view will be without data until a user enters new data.
Technical description
	• The submit button doesn't send the forms content.
	• It starts the saving to local store.
	• After saving to local store, the current person draft data will be removed from the store and from the page.
		○ We can use the code which is called by the reset button.

Show historic person data
Functional description
If the history page is loaded by the user the person dates will be shown to him. So he can see all existent person dates.
Technical description
	• If the history page is loaded, we load all persons from persons array in local store

     -->
</head>
<body>
<nav class="container p-3 bg-dark text-white text-left my-2">
    <a href="index.html" id="form-link">Form</a>
    <a href="submit-history.html" id="history-link">History</a>
</nav>
<form id="person-form" class=" container">
    <label class="fw-bold" for="first-name">First name</label><br>
    <input name="first-name" id="first-name" type="text" oninput="saveChange('first-name')"/><br><br>
    <label class="fw-bold" for="last-name">Last name</label><br>
    <input name="last-name" id="last-name" type="text" oninput="saveChange('last-name')"/><br><br>
    <label class="fw-bold" for="email">Email</label><br>
    <input name="email" id="email" type="email" oninput="saveChange('email')"/><br><br>
    <label class="fw-bold" for="phone">Phone</label><br>
    <input name="phone" id="phone" type="tel" oninput="saveChange('phone')"/><br><br>
    <label class="fw-bold" for="company">Company</label><br>
    <input name="company" id="company" type="text" oninput="saveChange('company')"/><br><br>
    <label class="fw-bold" for="address">Address</label><br>
    <input class="container-sm" name="address" id="address" type="text" oninput="saveChange('address')"/><br><br>
    <button class="" name="reset-button" id="reset-button" type="button" onclick="resetForm()">Reset form</button>
    <button class="" name="submit-button" id="submit-button" type="button" onclick="savePerson()">Submit form</button>
</form>

<script>
    window.onload = reloadFormData;

    /** Restore element value.
     * Restore value from local data store if value is found.
     * Restore to the default value otherwise.
     * elementId: ID of the element which value to restore. */
    function restoreElementValue(elementId) {
        const storedValue = localStorage.getItem(elementId);
        const element = document.getElementById(elementId);
        if (storedValue != null) {
            element.value = storedValue;
        } else {
            element.value = element.defaultValue;
        }
    }

    /** fill input fields with value from local save if available*/
    function reloadFormData() {
        restoreElementValue("first-name");
        restoreElementValue("last-name");
        restoreElementValue("email");
        restoreElementValue("phone");
        restoreElementValue("company")
        restoreElementValue("address");
    }

    function saveChange(changedElementId) {
        console.trace("saveChange() changedElementId: " + changedElementId)
        const elementValue = document.getElementById(changedElementId).value;
        localStorage.setItem(changedElementId, elementValue);
    }

    /** Reset the form (visible part and stored data). */
    function resetForm() {
        localStorage.clear();
        reloadFormData();
        console.trace("local storage was cleared.")
    }

    /** Add the person form data to persons container of local storage. */
    function savePerson() {
        const person = {
            "first-name": document.getElementById("first-name").value,
            "last-name": document.getElementById("last-name").value,
            "email": document.getElementById("email").value,
            "phone": document.getElementById("phone").value,
            "company": document.getElementById("company").value,
            "address": document.getElementById("address").value
        };
        const persons = JSON.parse(localStorage.getItem("persons"));
        if (persons == null) {
            localStorage.setItem("persons", JSON.stringify([person]));
        } else {
            persons.push(person);
            localStorage.setItem("persons", JSON.stringify(persons));
        }
        console.trace("person was saved to local storage.")
    }
</script>

</body>
</html>
